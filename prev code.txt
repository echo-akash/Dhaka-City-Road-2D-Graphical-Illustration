#include<windows.h>

#include <GL/glut.h>

#include <stdlib.h>
#include<math.h>
#define PI 3.1416

static float	tx	=  0.0;
static float	ty	=  0.0;
static float	metrorailcorrection	=  0.0;
static float	buildingcorrection	=  1.0;
static float	cloudcorrection	=  1.0;
static float	raincorrection	=  0.0;
static float	fc	=  0.0;
static float	car	=  2.0;
static float	cc	=  1.0;
static float	r	=  1.0;
float	p	=  0.0;

void init()
{
    glClearColor(0.0f, 0.0f, 0.0f, 0.0f);
    glOrtho(-5,5,-5,5,-5,5);
}

void circle(float radius_x, float radius_y)
{
	int i=0;
	float angle = 0.0;

	glBegin(GL_POLYGON);

		for(i = 0; i < 100; i++)
		{
			angle = 2 * PI * i / 100;
			glVertex2f (cos(angle) * radius_x, sin(angle) * radius_y);
		}

	glEnd();
}

void metrorailbulldozer1()
{
    //metro rail bulldozer body
    glPushMatrix();
    glColor3f(0.98f,0.98f,0.40f);
    glTranslatef(tx, ty, 0);
    glRectf(-2.9, 0.4, -3.6, +0.1);
    glPopMatrix();

    //metro rail bulldozer head
    glColor3f(0.98f,0.98f,0.40f);
    glBegin(GL_POLYGON);
    glVertex2d(-3.4,0.4);
    glVertex2d(-2.9,0.4);
    glVertex2d(-2.9,0.6);
    glVertex2d(-3.3,0.6);
    glVertex2d(-3.3,0.6);
    glEnd();

    //metro rail bulldozer stick top
    glColor3f(0.98f,0.98f,0.40f);
    glBegin(GL_LINE_LOOP);
    glVertex2d(-3.4,0.4);
    glVertex2d(-3.7,0.7);
    glEnd();

    //metro rail bulldozer stick down
    glColor3f(0.98f,0.98f,0.40f);
    glBegin(GL_LINE_LOOP);
    glVertex2d(-3.7,0.7);
    glVertex2d(-3.9,0.2);
    glEnd();

    //metro rail bulldozer wheels
    glPushMatrix();
	glTranslatef(-3.0,0.0,0);
    glColor3f(0.0, 0.0, 0.0);
	circle(0.1,0.1);
	glPopMatrix();
	glPushMatrix();
	glTranslatef(-3.1-0.4,0.0,0);
    glColor3f(0.0, 0.0, 0.0);
	circle(0.1,0.1);
	glPopMatrix();
}

void metrorailpillar()
{
    //metro rail pillar body
    glPushMatrix();
    glColor3f(0.34f,0.38f,0.39f);
    glTranslatef(tx, ty, 0);
    glRectf(-3.9+metrorailcorrection, 1.2, -4.3+metrorailcorrection, 0.0);
    glPopMatrix();

    //metro rail pillar head
    glColor3f(0.34f,0.38f,0.39f);
    glBegin(GL_POLYGON);
    glVertex2d(-3.9+metrorailcorrection,1.2);
    glVertex2d(-3.8+metrorailcorrection,1.3);
    glVertex2d(-4.4+metrorailcorrection,1.3);
    glVertex2d(-4.3+metrorailcorrection,1.2);
    glVertex2d(-4.3+metrorailcorrection,1.2);
    glEnd();
}

void carstructure()
{
    //car body
    glPushMatrix();
    glColor3f(0.88f*cc,0.36f*cc,0.48f*cc);
    glTranslatef(tx, ty, 0);
    glRectf(-2.9+car, 0.4+0.2, -3.6+car, +0.1+0.2);
    glPopMatrix();

    //car head
    glColor3f(0.88f*cc,0.36f*cc,0.48f*cc);
    glBegin(GL_POLYGON);
    glVertex2d(-3.5+car,0.4+0.2);
    glVertex2d(-3.0+car,0.4+0.2);
    glVertex2d(-3.1+car,0.6+0.2);
    glVertex2d(-3.4+car,0.6+0.2);
    glVertex2d(-3.4+car,0.6+0.2);
    glEnd();

    //car wheels
    glPushMatrix();
	glTranslatef(-3.0+car,0.0+0.2,0);
    glColor3f(0.0, 0.0, 0.0);
	circle(0.1,0.1);
	glPopMatrix();
	glPushMatrix();
	glTranslatef(-3.1-0.4+car,0.0+0.2,0);
    glColor3f(0.0, 0.0, 0.0);
	circle(0.1,0.1);
	glPopMatrix();
}

void buildingstructure()
{
    //building1
    glPushMatrix();
    glColor3f(0.82f,0.85f,0.71f);
    glTranslatef(tx, ty, 0);
    glRectf(-2.6+buildingcorrection, 4.0, -4.3+buildingcorrection, +0.8);
    glPopMatrix();

    //building1 windows left column
    glPushMatrix();
    glColor3f(0.57f,0.59f,0.49f);
    glTranslatef(tx, ty, 0);
    glRectf(-2.9-0.8+buildingcorrection, 1.5, -3.2-0.8+buildingcorrection, +1.2);
    glPopMatrix();
    glPushMatrix();
    glColor3f(0.57f,0.59f,0.49f);
    glTranslatef(tx, ty, 0);
    glRectf(-2.9-0.8+buildingcorrection, 1.5+0.9, -3.2-0.8+buildingcorrection, +1.2+0.9);
    glPopMatrix();
    glPushMatrix();
    glColor3f(0.57f,0.59f,0.49f);
    glTranslatef(tx, ty, 0);
    glRectf(-2.9-0.8+buildingcorrection, 1.5+0.9*2, -3.2-0.8+buildingcorrection, +1.2+0.9*2);
    glPopMatrix();

    //building1 windows right column
    glPushMatrix();
    glColor3f(0.57f,0.59f,0.49f);
    glTranslatef(tx, ty, 0);
    glRectf(-2.9+buildingcorrection, 1.5, -3.2+buildingcorrection, +1.2);
    glPopMatrix();
    glPushMatrix();
    glColor3f(0.57f,0.59f,0.49f);
    glTranslatef(tx, ty, 0);
    glRectf(-2.9+buildingcorrection, 1.5+0.9, -3.2+buildingcorrection, +1.2+0.9);
    glPopMatrix();
    glPushMatrix();
    glColor3f(0.57f,0.59f,0.49f);
    glTranslatef(tx, ty, 0);
    glRectf(-2.9+buildingcorrection, 1.5+0.9*2, -3.2+buildingcorrection, +1.2+0.9*2);
    glPopMatrix();
}

void Cloud()
{
    glPushMatrix();
	glTranslatef(-3.0+cloudcorrection,4.5,0);
    glColor3f(0.67, 0.67, 0.67);
	circle(0.3,0.3);
	glPopMatrix();
	glPushMatrix();
	glTranslatef(-3.2+cloudcorrection,4.6,0);
    glColor3f(0.67, 0.67, 0.67);
	circle(0.3,0.3);
	glPopMatrix();
	glPushMatrix();
	glTranslatef(-3.2+cloudcorrection,4.4,0);
    glColor3f(0.67, 0.67, 0.67);
	circle(0.3,0.3);
	glPopMatrix();
	glPushMatrix();
	glTranslatef(-3.5+cloudcorrection,4.6,0);
    glColor3f(0.67, 0.67, 0.67);
	circle(0.3,0.3);
	glPopMatrix();
	glPushMatrix();
	glTranslatef(-3.5+cloudcorrection,4.4,0);
    glColor3f(0.67, 0.67, 0.67);
	circle(0.3,0.3);
	glPopMatrix();
	glPushMatrix();
	glTranslatef(-3.7+cloudcorrection,4.5,0);
    glColor3f(0.67, 0.67, 0.67);
	circle(0.3,0.3);
	glPopMatrix();
}

void roadbroken()
{
    //broken road triangle
    glBegin(GL_TRIANGLES);
    glColor3f(0.69f,0.62f,0.55f);
    glVertex2d(-2.1,-0.5);
    glColor3f(0.69f,0.19f,0.06f);
    glVertex2d(-1.8,-0.6);
    glColor3f(0.69f,0.45f,0.27f);
    glVertex2d(-1.9,-0.3);
    glEnd();
    //broken road circle
    glTranslatef(-0.5,0.3,0);
    glColor3f(0.66f, 0.23f, 0.24f);
	circle(0.05,0.17);
	glTranslatef(2.5,-0.5,0);
    glColor3f(0.66f, 0.23f, 0.24f);
	circle(0.15,0.01);
	//broken road quad
	glColor3f(0.66f,0.22f,0.22f);
    glBegin(GL_QUADS);
    glVertex2d(2.5,-0.1);
    glVertex2d(2.4,-0.3);
    glVertex2d(2.6,-0.3);
    glVertex2d(2.5,-0.2);
    glColor3f(0.66f,0.22f,0.22f);
    glBegin(GL_QUADS);
    glVertex2d(2.5,0.1);
    glVertex2d(2.4,0.3);
    glVertex2d(2.7,0.3);
    glVertex2d(2.5,0.2);
    glEnd();
}

void rain(void)
{
    //rain stick
    glColor3f(1.0, 1.0, 1.0);
	glTranslatef(tx,ty,0);
	glBegin(GL_LINE_LOOP);
    glVertex2d(4.9,4.9+p);
    glVertex2d(4.8,4.6+p);
    glEnd();
    glBegin(GL_LINE_LOOP);
    glVertex2d(4.3,p+4.9);
    glVertex2d(4.2,p+4.6);
    glEnd();
    glBegin(GL_LINE_LOOP);
    glVertex2d(3.7,p+4.9);
    glVertex2d(3.6,p+4.6);
    glEnd();
    glBegin(GL_LINE_LOOP);
    glVertex2d(3.1,p+4.9);
    glVertex2d(3.0,p+4.6);
    glEnd();
    glBegin(GL_LINE_LOOP);
    glVertex2d(2.5,p+4.9);
    glVertex2d(2.4,p+4.6);
    glEnd();
    glBegin(GL_LINE_LOOP);
    glVertex2d(1.9,p+4.9);
    glVertex2d(1.8,p+4.6);
    glEnd();
    glBegin(GL_LINE_LOOP);
    glVertex2d(1.3,p+4.9);
    glVertex2d(1.2,p+4.6);
    glEnd();
    glBegin(GL_LINE_LOOP);
    glVertex2d(0.7,p+4.9);
    glVertex2d(0.6,p+4.6);
    glEnd();
    glBegin(GL_LINE_LOOP);
    glVertex2d(0.1,p+4.9);
    glVertex2d(0.0,p+4.6);
    glEnd();
    glBegin(GL_LINE_LOOP);
    glVertex2d(-0.5,p+4.9);
    glVertex2d(-0.6,p+4.6);
    glEnd();
    glBegin(GL_LINE_LOOP);
    glVertex2d(-1.1,p+4.9);
    glVertex2d(-1.2,p+4.6);
    glEnd();
    glBegin(GL_LINE_LOOP);
    glVertex2d(-1.7,p+4.9);
    glVertex2d(-1.8,p+4.6);
    glEnd();
    glBegin(GL_LINE_LOOP);
    glVertex2d(-2.3,p+4.9);
    glVertex2d(-2.4,p+4.6);
    glEnd();
    glBegin(GL_LINE_LOOP);
    glVertex2d(-2.9,p+4.9);
    glVertex2d(-3.0,p+4.6);
    glEnd();
    glBegin(GL_LINE_LOOP);
    glVertex2d(-3.5,p+4.9);
    glVertex2d(-3.6,p+4.6);
    glEnd();
    glBegin(GL_LINE_LOOP);
    glVertex2d(-4.1,p+4.9);
    glVertex2d(-4.2,p+4.6);
    glEnd();


}

void rainfall()
{
    /*if(p>=-5.0)
        p=p-0.09;

    else
        p=5;
    glutPostRedisplay();*/
    glPushMatrix();
    rain();
    for(int i=1;i<=10;i++){
    p-=0.5;
    rain();}
    glPopMatrix();

}

void flood()
{
    /*
    glPushMatrix();
    glColor3f(0.85f,0.86f,0.85f);
    glTranslatef(tx, ty, 0);
    glRectf(5.0*fc, 0.7*fc, -5.0*fc, -0.7*fc);
    glPopMatrix();*/
    glBegin(GL_QUADS);
	glColor3f(0.81, 0.84, 0.84);
	glVertex2d(5.0*fc, 0.5*fc);
	glColor3f(0.67, 0.7, 0.7);
	glVertex2d(5.0*fc, -0.7*fc);
	glColor3f(0.53, 0.54, 0.54);
	glVertex2d(-5.0*fc, -0.7*fc);
	glColor3f(0.67, 0.67, 0.69);
	glVertex2d(-5.0*fc, 0.5*fc);
	glEnd();
}

static GLfloat spin = 0.0;//spin korar jnne initial degree

void spinDisplay_left(void)
{
   spin = spin + 1;
   if (spin > 360.0)
      spin = spin - 360.0;
    glutPostRedisplay();
}

void spinDisplay_right(void)
{
   spin = spin - 1;
   if (spin > 360.0)
      spin = spin - 360.0;
   glutPostRedisplay();
}

void my_mouse(int button, int state, int x, int y)
{
   switch (button) {
      case GLUT_LEFT_BUTTON:
         if (state == GLUT_DOWN)
            //glutIdleFunc(spinDisplay_left);
         break;
      case GLUT_MIDDLE_BUTTON:
      case GLUT_RIGHT_BUTTON:
         if (state == GLUT_DOWN)
			//glutIdleFunc(spinDisplay_right);
          //glutIdleFunc(NULL); // make idle function inactive
         break;
      default:
         break;
   }
}

void mydisplay()
{


    glClear(GL_COLOR_BUFFER_BIT);

    glPopMatrix();
    glColor3f(0, 0, 0);
    glTranslatef(tx,ty,0);
    glRectf(25.0,25.0,-25.0,-25.0); /// Screen White
    glPopMatrix();

    //building1
    glPushMatrix();
    buildingstructure();
    glPopMatrix();

    //building2
    glPushMatrix();
    buildingcorrection=buildingcorrection+3;
    buildingstructure();
    glPopMatrix();

    //building3
    glPushMatrix();
    buildingcorrection=buildingcorrection+3;
    buildingstructure();
    glPopMatrix();

    //building4
    glPushMatrix();
    buildingcorrection=buildingcorrection-8.5;
    buildingstructure();
    glPopMatrix();

    //road
    glPushMatrix();
    glColor3f(0.58f,0.54f,0.57f);
    glTranslatef(tx, ty, 0);
    glRectf(5, 0.6, -5, -0.6);
    glPopMatrix();

    //road divider
    glColor3f(0.97f,1.0f,0.97f);
    glBegin(GL_LINE_LOOP);
    glVertex2d(-5.0,0.0);
    glVertex2d(-4.5,0.0);
    glEnd();

    //road divider
    glColor3f(0.97f,1.0f,0.97f);
    glBegin(GL_LINE_LOOP);
    glVertex2d(5.0,0.0);
    glVertex2d(2.5,0.0);
    glEnd();

    //metro rail 2
    glPushMatrix();
    metrorailcorrection+=2;
    metrorailpillar();
    glPopMatrix();

    //metro rail 3
    glPushMatrix();
    metrorailcorrection+=2;
    metrorailpillar();
    glPopMatrix();

    //metro rail 4
    glPushMatrix();
    metrorailcorrection+=2;
    metrorailpillar();
    glPopMatrix();

    //metro rail 5
    glPushMatrix();
    metrorailcorrection+=2;
    metrorailpillar();
    glPopMatrix();

    //car1 body
    glPushMatrix();
    carstructure();
    glPopMatrix();

    //road broken
    glPushMatrix();
    roadbroken();
    glPopMatrix();

    //bus body
    glPushMatrix();
    glColor3f(0.16f,0.30f,0.17f);
    glTranslatef(tx, ty, 0);
    glRectf(0.2, -0.0, -1.0, -0.4);
    glPopMatrix();
    //bus windows
    glPushMatrix();
    glColor3f(1.4f,1.2f,1.17f);
    glTranslatef(tx, ty, 0);
    glRectf(0.0, -0.1, -0.1, -0.2);
    glPopMatrix();
    glPushMatrix();
    glColor3f(1.4f,1.2f,1.17f);
    glTranslatef(tx, ty, 0);
    glRectf(0.0-0.4, -0.1, -0.1-0.4, -0.2);
    glPopMatrix();
    glPushMatrix();
    glColor3f(1.4f,1.2f,1.17f);
    glTranslatef(tx, ty, 0);
    glRectf(0.0-0.8, -0.1, -0.1-0.8, -0.2);
    glPopMatrix();
    //bus wheels
    glPushMatrix();
    glRotatef(spin, 0.0, 0.0, 1.0);
	glTranslatef(-0.7,-0.5,0);
    glColor3f(0.0, 0.0, 0.0);
	circle(0.1,0.1);
	glPopMatrix();
	glPushMatrix();
	glRotatef(spin, 0.0, 0.0, 1.0);
	glTranslatef(-0.1,-0.50,0);
    glColor3f(0.0, 0.0, 0.0);
	circle(0.1,0.1);
	glPopMatrix();













    glFlush();



}

void my_keyboard(unsigned char key, int x, int y)
{

	switch (key) {

    case 'p':
        //metro rail pillar1
        glPushMatrix();
        metrorailcorrection=0;
        metrorailpillar();
        glPopMatrix();
        glFlush();
        break;
    case 'b':
        //metro rail bulldozer
        glPushMatrix();
        PlaySound("tractor-digging-daniel_simon-[AudioTrimmer.com].wav", NULL, SND_FILENAME| SND_ASYNC);
        metrorailbulldozer1();
        glPopMatrix();
        glFlush();
        break;
    case 'c':
        //add cars
        glPushMatrix();
        car=car+2;
        cc=cc+0.51/0.97;
        PlaySound("Horn Honk-SoundBible.com-1162546405.wav", NULL, SND_FILENAME| SND_ASYNC);
        carstructure();
        glPopMatrix();
        glFlush();
        break;
    case 'r':
        //cloud
        glPushMatrix();
        PlaySound("storm-thunder.wav", NULL, SND_FILENAME| SND_ASYNC);
        Cloud();
        glPopMatrix();
        glPushMatrix();
        cloudcorrection+=2;
        Cloud();
        glPopMatrix();
        glFlush();
        break;
    case 'f':
        glPushMatrix();
        fc=1;
        flood();
        glPopMatrix();
        glFlush();
        break;
    case 'x':
        //rain

        glPushMatrix();
        rainfall();
        glPopMatrix();
        glFlush();
        break;
	  default:
			break;
	}
}

int main(int argc, char *argv[])
{
    glutInitDisplayMode(GLUT_SINGLE | GLUT_RGB);
    glutInitWindowSize(1250, 640);
    glutInitWindowPosition(0, 0);
    glutCreateWindow("Evaluation");
    init();
    glutDisplayFunc(mydisplay);
    glutKeyboardFunc(my_keyboard);
    glutMouseFunc(my_mouse);
    //glutMouseFunc();
    glutMainLoop();
    return 0;
}
